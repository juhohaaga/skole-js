<html>
	<head>
		<meta charset="utf-8" />
		<title>Kurssit</title>
		<!-- link rel="stylesheet" type="text/css" href="src/css/main.css" / -->
		<script src="src/js/react.min.js"></script>
		<script src="src/js/react-dom.min.js"></script>
		<script src="src/js/browser.min.js"></script>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		<script src="app/myboard.js"></script>

		<style>
			.extra-widthcolumn {width:70%;}
			.extra-owntextarea {height:30px;width:60%;margin: 15px;float:left;clear:both;}
		</style>

	</head>
	<body>
		<script type="text/babel">

		var Course = React.createClass({

			//Alustus: Mikään kursseista ei ole edit -tilassa
			getInitialState: function() {
				return {editing: false}
			},

			//Vaihtaa vain kurssin editointi-tilan
			edit: function () {
				this.setState({editing: true});
			},
			//POISTO
			//Siletä props
			remove: function () {
				this.props.deleteFromBoard(this.props.index)
			}, 

			//TALLENNUS
			//Selitä refs
			save: function () {
				this.props.updateCourseText(this.refs.newText.value, this.props.index);
				this.setState({editing: false});
			}, 

			//Tulostetaan kurssirivi
			//Näytetään vain buttonit 
			renderNormal: function () {
				return (
					<tr>	
      					<td className="extra-widthcolumn">{this.props.children}</td>
      					<td><button onClick={this.edit} className="btn-primary" >Muokkaa</button></td>
      					<td><button onClick={this.remove} className="btn-success" >Poista</button></td>
    				</tr>

				);
			},

			//Tulostetaan kurssiriville editointityökalut
			//Klikillä ajetaan save -funktio
			renderForm: function () {
				return (
					<div className="row">			
						<textarea className="md-textarea form-control extra-owntextarea" ref="newText" defaultValue={this.props.children}></textarea>
						<button onClick={this.save} className="btn-success">Save</button>
					</div>
				);
			},

			render: function () {
				if(this.state.editing) {
					return this.renderForm();
				} else {
					return this.renderNormal();
				}
			}
		});

		// Ruvetaan rakentamaan boardia
		// 1. Haetaan aluksi kaikki kurssit taustalta
		// 2. Funktiot kurssien hallintaan: Poisto ja update
		// 3. Luupataan läpi kaikki kurssit, ja tulostetaan ne
		// 4. Luodaan fronttiin vielä nappi, josta kursseja voi lisätä
		//


		var Board = React.createClass({

			//Tulostetaan olemassa olevat kurssit
			getInitialState: function () {
				return {
					courses: [
						'Opiskelu- ja työelämätaitojen kehittäminen, COM1TN010',
						'ICT and Business English, ENG1TN003',
						'Työvälineet myynnin ja palvelun ympäristössä, SAL1TN001'
					]
				}
			},

			//Functio, jolla lisätään kurssi listalle
			add: function (text) {
				var arr = this.state.courses;
				arr.push(text);
				this.setState({courses: arr})
			},

			//Funktio jolla poistetaan listalta
			removeCourse: function (i) {
				console.log('Remove course' + i);
				var arr = this.state.courses;
				arr.splice(i,1);
				this.setState({courses: arr})
			},

			//päivitys DOMiin
			updateCourse: function (newText, i) {
				console.log('updating course');
				var arr = this.state.courses;
				arr[i] = newText;
				this.setState({courses: arr})
			},

			//Define
			eachCourse: function (text, i) {
				return (
						<Course key={i} index={i} updateCourseText={this.updateCourse} deleteFromBoard={this.removeCourse}>
						{text}
						</Course>
						);
			},

			//Rendataan koko boardi ja jokainen yksittäinen kurssi
			render: function () {
				return (
					<div>
						<div className="row">
							<button onClick={this.add.bind(null, 'Course name or id')} className="btn-info create">Add</button>
						</div>
						<div className="board">
							<div className="row">
		    					<table className="table">
		    						<tbody>
										{this.state.courses.map(this.eachCourse)}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				);
			}

		});

		//
		// Tulostetaan koko container
		//
		ReactDOM.render(<Board/>, document.getElementById('container'));

		</script>
	

		<!-- Rakenne-html, jonka sisälle luodaan varsinainen container joka tulostaa javascriptin tulostaman sisällöt -->
		<div class="container">
		  <div class="jumboTron"><h1>Juho kurssit</h1></div>
		  <div class="container" id="container"></div>
		</div>
		
	</body>
</html>